{
  "rules": {
    ".read": "auth != null",
    ".write": "false",
    "users": {
      "$user_id": {
        // grants write access to the owner of this user account
        // whose uid must exactly match the key ($user_id)
        ".write": "$user_id === auth.uid"
      }
    },
    "stadiums": {
      // Section write is limited to admins
      ".write": "root.child('admins').child(auth.uid).val() == true"
    },
    "teams": {
      // Section write is limited to admins
      ".write": "root.child('admins').child(auth.uid).val() == true"
    },
    "groups": {
      "$groupId": {
        "members": {
          "$user_id": {
            // Normal User can only write its own id into 'awaiting' status
            // Group admin can do anything
            ".write": "($user_id === auth.uid && newData.isString() && newData.val() == 'awaiting') || (root.child('groups').child($groupId).child('admins').child(auth.uid).val() == true)"
          }
        }
      }
    },
    "matches": {
      // Section write is limited to admins
      ".write": "root.child('admins').child(auth.uid).val() == true",
      ".indexOn": ["dateTime", "phase"]
    },
    "bets": {
      "$matchId": {
        "users": {
          "$uid": {
            // Grants write access if:
            // - The node is associated with the current user
            // - The match begin date is before now
            ".write": "$uid == auth.uid && root.child('matches').child($matchId).child('dateTime').val() < now",
            "teamA": {
              // Ensure scores are positive and are numbers
              ".validate": "newData.isNumber() && newData.val() >= 0"
            },
            "teamB": {
              // Ensure scores are positive and are numbers
              ".validate": "newData.isNumber() && newData.val() >= 0"
            }
          }
        }
      }
    }
  }
}
